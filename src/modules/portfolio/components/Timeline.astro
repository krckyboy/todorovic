---
import styles from "./Timeline.module.css";
import TimelineItem from "./TimelineItem.astro";
import { getSortedExperiences } from "../services/experiences";

interface Props {
  title?: string;
}

const { title = "Experience" } = Astro.props;
const sortedExperiences = getSortedExperiences();
---

<section class={styles.section}>
  <h2 class={styles.heading}>{title}</h2>
  <div class={styles.timeline}>
    {
      sortedExperiences.map((companyGroup) => (
        <div class={styles.yearGroup}>
          <div class={styles.yearMarker}>
            <span class={styles.year}>{companyGroup.rangeLabel}</span>
            <span class={styles.line} />
          </div>
          <div class={styles.groupContent}>
            <div class={styles.companyHeader}>
              <h3 class={styles.company}>{companyGroup.company}</h3>
              <p class={styles.location}>{companyGroup.location}</p>
              <p class={styles.companyMeta}>
                {companyGroup.companyPeriod} Â· {companyGroup.companyDuration}
              </p>
            </div>
            <div class={styles.roles}>
              {companyGroup.roles.map((role) => (
                <TimelineItem
                  title={role.title}
                  period={role.period}
                  duration={role.duration}
                  isCurrent={role.isCurrent}
                />
              ))}
            </div>
          </div>
        </div>
      ))
    }
  </div>
</section>
