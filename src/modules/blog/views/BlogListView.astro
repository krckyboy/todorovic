---
import BlogFilter from '../components/BlogFilter.tsx';
import { getCollection } from 'astro:content';

interface Props {
  showHeader?: boolean;
  headerTitle?: string;
  headerIntro?: string;
}

const {
  showHeader = true,
  headerTitle = 'Blog',
  headerIntro = 'Thoughts and tutorials on web development and software engineering.',
} = Astro.props;

const posts = await getCollection('blog', ({ data }) => !data.draft);
const sortedPosts = posts.sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
);

const allCategories = [
  ...new Set(sortedPosts.flatMap((post) => post.data.tags || [])),
].sort();

const serializedPosts = sortedPosts.map((post) => ({
  slug: post.slug,
  title: post.data.title,
  description: post.data.description,
  pubDate: post.data.pubDate.toISOString(),
  tags: post.data.tags || [],
}));
---

<div class="blog-list-view">
  {
    showHeader && (
      <header class="page-header">
        <h1 class="u-heading-3xl-bold">{headerTitle}</h1>
        <p class="intro">{headerIntro}</p>
      </header>
    )
  }

  <BlogFilter client:load posts={serializedPosts} categories={allCategories} />
</div>

<style>
  .page-header {
    padding-top: var(--spacing-2xl);
    margin-bottom: var(--spacing-xl);
  }

  .page-header h1 {
    margin-bottom: var(--spacing-md);
  }

  .intro {
    font-size: var(--font-size-lg);
    line-height: var(--line-height-relaxed);
    color: var(--color-text-muted);
  }
</style>
