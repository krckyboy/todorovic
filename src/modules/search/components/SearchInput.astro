---
import styles from './SearchInput.module.css';
---

<div class={styles.header}>
  <div class={styles.wrapper}>
    <svg class={styles.icon} xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
    </svg>
    <label for="search-input" class="visually-hidden">Search</label>
    <input
      type="text"
      id="search-input"
      class={styles.input}
      placeholder="Search..."
      autocomplete="off"
    />
  </div>
  <button
    type="button"
    class={styles.closeButton}
    id="search-close"
    aria-label="Close search"
  >
    <svg class={styles.closeIcon} xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
    </svg>
  </button>
</div>

<script is:inline>
  const searchInput = document.getElementById('search-input');
  const closeButton = document.getElementById('search-close');

  let debounceTimer;

  searchInput?.addEventListener('input', (e) => {
    const query = e.target.value;
    clearTimeout(debounceTimer);
    debounceTimer = setTimeout(() => {
      window.dispatchEvent(new CustomEvent('search:query', { detail: { query } }));
    }, 200);
  });

  closeButton?.addEventListener('click', () => {
    window.dispatchEvent(new CustomEvent('search:close'));
  });

  // Focus input when modal opens
  window.addEventListener('search:open', () => {
    searchInput?.focus();
  });

  // Clear input when modal closes
  window.addEventListener('search:close', () => {
    if (searchInput) searchInput.value = '';
  });
</script>
