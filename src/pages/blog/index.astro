---
import BaseLayout from "../../layouts/BaseLayout.astro";
import BlogFilter from "../../components/BlogFilter.tsx";
import { getCollection } from "astro:content";

const posts = await getCollection("blog", ({ data }) => !data.draft);
const sortedPosts = posts.sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
);

// Extract unique categories from all posts
const allCategories = [
  ...new Set(sortedPosts.flatMap((post) => post.data.tags || [])),
].sort();

// Serialize posts for client component
const serializedPosts = sortedPosts.map((post) => ({
  slug: post.slug,
  title: post.data.title,
  description: post.data.description,
  pubDate: post.data.pubDate.toISOString(),
  tags: post.data.tags || [],
}));

const title = "Blog - Dusan Todorovic";
const description =
  "Articles about web development, programming, and technology.";
---

<BaseLayout title={title} description={description}>
  <div class="container content">
    <header class="page-header">
      <h1>Blog</h1>
      <p class="intro">
        Thoughts and tutorials on web development and software engineering.
      </p>
    </header>

    <BlogFilter
      client:load
      posts={serializedPosts}
      categories={allCategories}
    />
  </div>
</BaseLayout>

<style>
  .page-header {
    padding-top: var(--spacing-2xl);
    margin-bottom: var(--spacing-xl);
  }

  h1 {
    font-family: var(--font-family-heading);
    font-size: var(--font-size-3xl);
    font-weight: var(--font-weight-bold);
    margin-bottom: var(--spacing-md);
  }

  .intro {
    font-size: var(--font-size-lg);
    line-height: var(--line-height-relaxed);
    color: var(--color-text-muted);
  }
</style>
