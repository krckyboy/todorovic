---
import BaseLayout from '../../layouts/BaseLayout.astro';
import BlogFilter from '../../modules/blog/components/BlogFilter.tsx';
import { getCollection } from 'astro:content';

const posts = await getCollection('blog', ({ data }) => !data.draft);
const sortedPosts = posts.sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
);

// Extract unique categories from all posts
const allCategories = [
  ...new Set(sortedPosts.flatMap((post) => post.data.tags || [])),
].sort();

// Serialize posts for client component
const serializedPosts = sortedPosts.map((post) => ({
  slug: post.slug,
  title: post.data.title,
  description: post.data.description,
  pubDate: post.data.pubDate.toISOString(),
  tags: post.data.tags || [],
}));

const title = 'Blog | Dušan Todorović on Web Development and Engineering';
const description =
  'Articles on frontend engineering, React, team leadership, and AI-assisted software development workflows.';
---

<BaseLayout title={title} description={description}>
  <div class="container content">
    <header class="page-header">
      <h1 class="u-heading-3xl-bold">Blog</h1>
      <p class="intro">
        Thoughts and tutorials on web development and software engineering.
      </p>
    </header>

    <BlogFilter
      client:load
      posts={serializedPosts}
      categories={allCategories}
    />
  </div>
</BaseLayout>

<style>
  .page-header {
    padding-top: var(--spacing-2xl);
    margin-bottom: var(--spacing-xl);
  }

  h1 {
    margin-bottom: var(--spacing-md);
  }

  .intro {
    font-size: var(--font-size-lg);
    line-height: var(--line-height-relaxed);
    color: var(--color-text-muted);
  }
</style>
